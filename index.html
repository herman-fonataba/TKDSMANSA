<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Multi-Role System</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
            overflow-x: hidden;
        }
        
        html {
            overflow-x: hidden;
        }
        
        * {
            box-sizing: border-box;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        /* Mobile-first responsive design */
        .mobile-sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
        }
        .mobile-sidebar.open {
            transform: translateX(0);
        }
        
        /* Custom scrollbar for better mobile experience */
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 2px;
        }
        
        /* Table responsive wrapper - ONLY table scrolls horizontally */
        .table-container {
            overflow-x: auto;
            overflow-y: visible;
            -webkit-overflow-scrolling: touch;
            width: 100%;
            max-width: 100%;
            position: relative;
            display: block;
            margin: 0;
            padding: 0;
        }
        
        /* Custom scrollbar for tables - desktop */
        .table-container::-webkit-scrollbar {
            height: 12px;
        }
        .table-container::-webkit-scrollbar-track {
            background: #e5e7eb;
            border-radius: 6px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background: #6b7280;
            border-radius: 6px;
        }
        .table-container::-webkit-scrollbar-thumb:hover {
            background: #4b5563;
        }
        
        /* Mobile scrollbar - thinner and more visible */
        @media (max-width: 768px) {
            .table-container::-webkit-scrollbar {
                height: 8px;
            }
            .table-container::-webkit-scrollbar-thumb {
                background: #9ca3af;
            }
        }
        
        /* Table stays within container but can scroll */
        .table-container table {
            width: max-content;
            min-width: 100%;
            display: table;
            margin: 0;
        }
        
        /* Prevent any element from causing horizontal scroll on page */
        .max-w-7xl,
        .container,
        main,
        #mainContent,
        .bg-white,
        .rounded-lg,
        .shadow {
            max-width: 100%;
            overflow-x: visible;
        }
        
        /* Ensure all parent containers don't overflow */
        #dashboard,
        #dashboard > div,
        .flex-1 {
            max-width: 100%;
            overflow-x: hidden;
        }
        
        /* Force body and html to never scroll horizontally */
        html, body {
            max-width: 100%;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Ensure all direct children of body don't overflow */
        body > * {
            max-width: 100%;
        }
        
        /* Mobile specific fixes */
        @media (max-width: 768px) {
            .table-container {
                border: 1px solid #e5e7eb;
                border-radius: 0.5rem;
                background: white;
            }
            
            /* Add visual indicator for scrollable table on mobile */
            .table-container::after {
                content: '‚Üê Geser untuk melihat lebih banyak ‚Üí';
                display: block;
                text-align: center;
                padding: 8px;
                font-size: 11px;
                color: #6b7280;
                background: #f9fafb;
                border-top: 1px solid #e5e7eb;
                position: sticky;
                bottom: 0;
                left: 0;
                width: 100%;
            }
            
            /* Hide indicator when scrolled */
            .table-container.scrolled::after {
                content: '';
                padding: 0;
            }
        }
        
        /* Mobile menu overlay */
        .mobile-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        /* Responsive text sizing */
        @media (max-width: 640px) {
            .responsive-text-lg { font-size: 1rem; }
            .responsive-text-xl { font-size: 1.125rem; }
            .responsive-text-2xl { font-size: 1.25rem; }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gradient-to-br from-blue-50 to-indigo-100 font-sans"><!-- Login Page -->
  <div id="loginPage" class="min-h-full flex items-center justify-center py-6 px-4 sm:py-12 sm:px-6 lg:px-8">
   <div class="max-w-md w-full space-y-6 sm:space-y-8 fade-in">
    <div class="text-center">
     <div class="mx-auto h-12 w-12 sm:h-16 sm:w-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4">
      <svg class="h-6 w-6 sm:h-8 sm:w-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
      </svg>
     </div>
     <h2 id="systemTitle" class="text-2xl sm:text-3xl font-bold text-gray-900 responsive-text-2xl">Dashboard Multi-Role</h2>
     <p id="companyName" class="mt-2 text-sm text-gray-600">PT. Teknologi Indonesia</p>
     <p id="welcomeMessage" class="mt-3 sm:mt-4 text-base sm:text-lg text-gray-700 responsive-text-lg">Selamat datang di sistem dashboard</p>
    </div>
    <div class="mt-6 sm:mt-8 space-y-3 sm:space-y-4"><button id="tokenLoginBtn" class="group relative w-full flex justify-center items-center py-3 sm:py-4 px-4 border border-transparent text-sm sm:text-base font-medium rounded-lg text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-200 active:scale-95 sm:hover:scale-105">
      <svg class="h-4 w-4 sm:h-5 sm:w-5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v-2H7v-2H4a1 1 0 01-1-1v-1.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
      </svg><span class="text-center">Login dengan Token<br class="sm:hidden"><span class="hidden sm:inline"> (</span><span class="text-xs sm:text-sm opacity-90">User</span><span class="hidden sm:inline">)</span></span> </button> <button id="credentialLoginBtn" class="group relative w-full flex justify-center items-center py-3 sm:py-4 px-4 border border-transparent text-sm sm:text-base font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all duration-200 active:scale-95 sm:hover:scale-105">
      <svg class="h-4 w-4 sm:h-5 sm:w-5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
      </svg><span class="text-center">Login Username &amp; Password<br class="sm:hidden"><span class="hidden sm:inline"> (</span><span class="text-xs sm:text-sm opacity-90">Admin/Monitor</span><span class="hidden sm:inline">)</span></span> </button>
    </div>
   </div>
  </div><!-- Token Login Modal -->
  <div id="tokenModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 p-4">
   <div class="relative top-4 sm:top-20 mx-auto p-4 sm:p-5 border w-full max-w-sm sm:max-w-md shadow-lg rounded-lg bg-white">
    <div class="mt-2 sm:mt-3">
     <h3 class="text-base sm:text-lg font-medium text-gray-900 text-center mb-4">Login dengan Token</h3>
     <form id="tokenForm" class="space-y-4">
      <div><label for="tokenInput" class="block text-sm font-medium text-gray-700">Token Akses</label> <input type="text" id="tokenInput" class="mt-1 block w-full px-3 py-2 sm:py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base" placeholder="Masukkan token Anda">
      </div>
      <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3"><button type="submit" class="w-full sm:flex-1 bg-green-600 text-white py-2 sm:py-3 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 font-medium"> Masuk </button> <button type="button" id="closeTokenModal" class="w-full sm:flex-1 bg-gray-300 text-gray-700 py-2 sm:py-3 px-4 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 font-medium"> Batal </button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Credential Login Modal -->
  <div id="credentialModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 p-4">
   <div class="relative top-4 sm:top-20 mx-auto p-4 sm:p-5 border w-full max-w-sm sm:max-w-md shadow-lg rounded-lg bg-white">
    <div class="mt-2 sm:mt-3">
     <h3 class="text-base sm:text-lg font-medium text-gray-900 text-center mb-4">Login Admin/Monitor</h3>
     <form id="credentialForm" class="space-y-4">
      <div><label for="usernameInput" class="block text-sm font-medium text-gray-700">Username</label> <input type="text" id="usernameInput" class="mt-1 block w-full px-3 py-2 sm:py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base" placeholder="Masukkan username">
      </div>
      <div><label for="passwordInput" class="block text-sm font-medium text-gray-700">Password</label>
       <div class="relative"><input type="password" id="passwordInput" class="mt-1 block w-full px-3 py-2 sm:py-3 pr-10 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-base" placeholder="Masukkan password"> <button type="button" onclick="togglePasswordVisibility('passwordInput', 'passwordToggleIcon')" class="absolute inset-y-0 right-0 flex items-center pr-3 mt-1">
         <svg id="passwordToggleIcon" class="h-5 w-5 text-gray-400 hover:text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
         </svg></button>
       </div>
      </div>
      <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3"><button type="submit" class="w-full sm:flex-1 bg-indigo-600 text-white py-2 sm:py-3 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-medium"> Masuk </button> <button type="button" id="closeCredentialModal" class="w-full sm:flex-1 bg-gray-300 text-gray-700 py-2 sm:py-3 px-4 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 font-medium"> Batal </button>
      </div>
     </form>
    </div>
   </div>
  </div><!-- Dashboard -->
  <div id="dashboard" class="hidden min-h-full"><!-- Navigation -->
   <nav class="bg-white shadow-sm border-b border-gray-200 relative z-30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
     <div class="flex justify-between h-14 sm:h-16">
      <div class="flex items-center"><!-- Mobile menu button --> <button id="mobileMenuBtn" class="lg:hidden p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 mr-2">
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg></button>
       <div class="flex-shrink-0">
        <div class="h-6 w-6 sm:h-8 sm:w-8 bg-indigo-600 rounded-full flex items-center justify-center">
         <svg class="h-3 w-3 sm:h-5 sm:w-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
         </svg>
        </div>
       </div>
       <div class="ml-3 sm:ml-4">
        <h1 class="text-sm sm:text-lg font-semibold text-gray-900"><span class="hidden sm:inline">Dashboard </span><span id="userRoleDisplay"></span></h1>
       </div>
      </div>
      <div class="flex items-center space-x-2 sm:space-x-4"><span id="userNameDisplay" class="text-xs sm:text-sm text-gray-700 hidden sm:block"></span> <button id="logoutBtn" class="bg-red-600 text-white px-2 sm:px-4 py-1 sm:py-2 rounded-md text-xs sm:text-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 font-medium"> Logout </button>
      </div>
     </div>
    </div>
   </nav><!-- Mobile menu overlay -->
   <div id="mobileMenuOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden mobile-overlay"></div><!-- Sidebar -->
   <div class="flex relative">
    <div id="sidebar" class="fixed lg:static inset-y-0 left-0 z-50 w-64 bg-gray-50 border-r border-gray-200 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out mobile-sidebar custom-scrollbar overflow-y-auto">
     <div class="flex items-center justify-between p-4 lg:hidden border-b border-gray-200"><span class="text-sm font-medium text-gray-900">Menu</span> <button id="closeMobileMenu" class="p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100">
       <svg class="h-5 w-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="6 18L18 6M6 6l12 12"></path>
       </svg></button>
     </div>
     <nav class="mt-2 lg:mt-5 px-2 pb-4">
      <div id="menuItems" class="space-y-1"><!-- Menu items will be populated by JavaScript -->
      </div>
     </nav>
    </div><!-- Main Content -->
    <div class="flex-1 lg:ml-0 min-h-screen">
     <div class="p-4 sm:p-6">
      <div id="mainContent" class="fade-in"><!-- Content will be populated by JavaScript -->
      </div>
     </div>
    </div>
   </div>
  </div><!-- Error Message -->
  <div id="errorMessage" class="hidden fixed top-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-50"><span id="errorText"></span>
  </div><!-- Success Message -->
  <div id="successMessage" class="hidden fixed top-4 right-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded z-50"><span id="successText"></span>
  </div>
  <script>
        let currentUser = null;
        let allData = [];
        let currentRecordCount = 0;

        const defaultConfig = {
            system_title: "Dashboard Taekwondo",
            company_name: "SMA Negeri 1 Kota Sorong",
            welcome_message: "Selamat datang di sistem dashboard"
        };

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                allData = data;
                currentRecordCount = data.length;
                
                // Update UI based on current view
                if (currentUser && document.getElementById('dashboard').style.display !== 'none') {
                    updateCurrentView();
                }
            }
        };

        // Element SDK Configuration
        async function onConfigChange(config) {
            const systemTitle = config.system_title || defaultConfig.system_title;
            const companyName = config.company_name || defaultConfig.company_name;
            const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;

            document.getElementById('systemTitle').textContent = systemTitle;
            document.getElementById('companyName').textContent = companyName;
            document.getElementById('welcomeMessage').textContent = welcomeMessage;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["system_title", config.system_title || defaultConfig.system_title],
                ["company_name", config.company_name || defaultConfig.company_name],
                ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
            ]);
        }

        // Initialize SDKs
        async function initializeSDKs() {
            try {
                if (window.dataSdk) {
                    const initResult = await window.dataSdk.init(dataHandler);
                    if (!initResult.isOk) {
                        console.error("Failed to initialize data SDK");
                    }
                }

                if (window.elementSdk) {
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange,
                        mapToCapabilities,
                        mapToEditPanelValues
                    });
                }
            } catch (error) {
                console.error("SDK initialization error:", error);
            }
        }

        // User roles and their menus
        const userMenus = {
            admin: [
                { id: 'home', name: 'Home', icon: 'home' },
                { id: 'data-nama', name: 'Data Nama', icon: 'users' },
                { id: 'absensi', name: 'Kehadiran', icon: 'calendar' },
                { id: 'dokumentasi', name: 'Dokumentasi', icon: 'document' },
                { id: 'data-monitor', name: 'Data Monitor', icon: 'eye' },
                { id: 'settingan', name: 'Settingan', icon: 'cog' }
            ],
            monitor: [
                { id: 'home', name: 'Home', icon: 'home' },
                { id: 'data-nama', name: 'Data Nama', icon: 'users' },
                { id: 'absensi', name: 'Kehadiran', icon: 'calendar' },
                { id: 'dokumentasi', name: 'Dokumentasi', icon: 'document' },
                { id: 'settingan', name: 'Settingan', icon: 'cog' }
            ],
            user: [
                { id: 'home', name: 'Home', icon: 'home' },
                { id: 'kehadiran', name: 'Kehadiran', icon: 'check' },
                { id: 'settingan', name: 'Settingan', icon: 'cog' }
            ]
        };

        // SVG Icons
        const icons = {
            home: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>',
            users: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>',
            calendar: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>',
            document: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>',
            eye: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>',
            check: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="5 13l4 4L19 7"></path>',
            cog: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>'
        };

        // Show/Hide functions
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('errorMessage').classList.add('hidden');
            }, 3000);
        }

        function showSuccess(message) {
            document.getElementById('successText').textContent = message;
            document.getElementById('successMessage').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('successMessage').classList.add('hidden');
            }, 3000);
        }

        // Authentication functions
        async function authenticateToken(token) {
            const users = allData.filter(item => item.type === 'user');
            const user = users.find(u => u.token === token);
            
            if (user) {
                return { 
                    success: true, 
                    user: { 
                        name: user.full_name || user.name, 
                        nickname: user.nickname || user.full_name || user.name,
                        role: 'user', 
                        token: user.token 
                    } 
                };
            }
            return { success: false, message: 'Token tidak valid' };
        }

        async function authenticateCredentials(username, password) {
            const accounts = allData.filter(item => item.type === 'account');
            const account = accounts.find(a => a.username === username && a.password === password);
            
            if (account) {
                return { 
                    success: true, 
                    user: { 
                        name: account.name, 
                        nickname: account.nickname || account.name,
                        role: account.role, 
                        username: account.username 
                    } 
                };
            }
            return { success: false, message: 'Username atau password salah' };
        }

        // Dashboard functions
        function showDashboard(user) {
            currentUser = user;
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').classList.remove('hidden');
            
            // Display nickname if available, otherwise use full name
            const displayName = user.nickname || user.name;
            document.getElementById('userRoleDisplay').textContent = displayName;
            document.getElementById('userNameDisplay').textContent = displayName;
            
            renderMenu(user.role);
            showContent('home');
        }

        function renderMenu(role) {
            const menuContainer = document.getElementById('menuItems');
            const menus = userMenus[role] || [];
            
            menuContainer.innerHTML = menus.map(menu => `
                <button onclick="showContent('${menu.id}')" class="menu-item group flex items-center px-2 py-2 text-sm font-medium rounded-md text-gray-600 hover:bg-gray-50 hover:text-gray-900 w-full text-left transition-colors duration-200">
                    <svg class="text-gray-400 group-hover:text-gray-500 mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        ${icons[menu.icon]}
                    </svg>
                    ${menu.name}
                </button>
            `).join('');
        }

        function showContent(contentId) {
            // Close mobile menu when menu item is clicked
            closeMobileMenu();
            
            // Update active menu
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('bg-indigo-50', 'text-indigo-700');
                item.classList.add('text-gray-600');
            });
            
            event?.target?.closest('.menu-item')?.classList.add('bg-indigo-50', 'text-indigo-700');
            event?.target?.closest('.menu-item')?.classList.remove('text-gray-600');

            const mainContent = document.getElementById('mainContent');
            
            switch(contentId) {
                case 'home':
                    mainContent.innerHTML = getHomeContent();
                    break;
                case 'data-nama':
                    mainContent.innerHTML = getDataNamaContent();
                    break;
                case 'absensi':
                    mainContent.innerHTML = getAbsensiContent();
                    break;
                case 'dokumentasi':
                    mainContent.innerHTML = getDokumentasiContent();
                    break;
                case 'data-monitor':
                    mainContent.innerHTML = getDataMonitorContent();
                    break;
                case 'kehadiran':
                    mainContent.innerHTML = getKehadiranContent();
                    break;
                case 'settingan':
                    mainContent.innerHTML = getSettinganContent();
                    break;
                default:
                    mainContent.innerHTML = '<div class="text-center py-12"><h2 class="text-2xl font-semibold text-gray-900">Halaman tidak ditemukan</h2></div>';
            }
        }

        function updateCurrentView() {
            // This function can be called when data changes to refresh the current view
            // Implementation depends on the current active content
        }

        // Content generators
        function getHomeContent() {
            const stats = {
                totalUsers: allData.filter(item => item.type === 'user').length,
                totalAccounts: allData.filter(item => item.type === 'account').length,
                totalAttendance: allData.filter(item => item.type === 'attendance').length
            };

            return `
                <div class="mb-6 sm:mb-8">
                    <h1 class="text-xl sm:text-2xl font-bold text-gray-900 responsive-text-xl">Dashboard</h1>
                    <p class="mt-2 text-sm sm:text-base text-gray-600">Selamat datang, ${currentUser.nickname || currentUser.name}</p>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-4 sm:p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        ${icons.users}
                                    </svg>
                                </div>
                                <div class="ml-3 sm:ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-xs sm:text-sm font-medium text-gray-500 truncate">Total Pengguna</dt>
                                        <dd class="text-lg sm:text-xl font-medium text-gray-900">${stats.totalUsers}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-4 sm:p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        ${icons.eye}
                                    </svg>
                                </div>
                                <div class="ml-3 sm:ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-xs sm:text-sm font-medium text-gray-500 truncate">Admin/Monitor</dt>
                                        <dd class="text-lg sm:text-xl font-medium text-gray-900">${stats.totalAccounts}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white overflow-hidden shadow rounded-lg sm:col-span-2 lg:col-span-1">
                        <div class="p-4 sm:p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <svg class="h-5 w-5 sm:h-6 sm:w-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        ${icons.calendar}
                                    </svg>
                                </div>
                                <div class="ml-3 sm:ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-xs sm:text-sm font-medium text-gray-500 truncate">Total Kehadiran</dt>
                                        <dd class="text-lg sm:text-xl font-medium text-gray-900">${stats.totalAttendance}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white shadow rounded-lg p-4 sm:p-6">
                    <h2 class="text-base sm:text-lg font-medium text-gray-900 mb-4">Aktivitas Terbaru</h2>
                    <div class="space-y-3">
                        <div class="flex items-center text-sm text-gray-600">
                            <div class="w-2 h-2 bg-green-400 rounded-full mr-3 flex-shrink-0"></div>
                            <span>Sistem beroperasi normal</span>
                        </div>
                        <div class="flex items-center text-sm text-gray-600">
                            <div class="w-2 h-2 bg-blue-400 rounded-full mr-3 flex-shrink-0"></div>
                            <span>Dashboard siap digunakan</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function getDataNamaContent() {
            const users = allData.filter(item => item.type === 'user');
            
            return `
                <div class="mb-6 sm:mb-8">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0">
                        <h1 class="text-xl sm:text-2xl font-bold text-gray-900 responsive-text-xl">Data Nama Pengguna</h1>
                        ${currentUser.role === 'admin' ? `
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                                <button onclick="showContent('data-nama')" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 text-sm sm:text-base font-medium flex items-center justify-center">
                                    <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Refresh
                                </button>
                                <button onclick="showAddUserForm()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm sm:text-base font-medium">
                                    Tambah Pengguna
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                <div class="bg-white shadow rounded-lg overflow-hidden">
                    <div class="table-container">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Lengkap</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Panggilan</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">JK</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kelas</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nomor WhatsApp</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Token</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal Dibuat</th>
                                    ${currentUser.role === 'admin' ? '<th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>' : ''}
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${users.map(user => `
                                    <tr>
                                        <td class="px-2 sm:px-4 py-4 text-sm">
                                            <div class="font-medium text-gray-900 truncate max-w-32 sm:max-w-40">${user.full_name || user.name || '-'}</div>
                                        </td>
                                        <td class="px-2 sm:px-4 py-4 text-sm text-gray-500">
                                            <div class="truncate max-w-24">${user.nickname || '-'}</div>
                                        </td>
                                        <td class="px-2 sm:px-4 py-4 text-sm text-gray-500">
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${user.gender === 'Laki-laki' ? 'bg-blue-100 text-blue-800' : user.gender === 'Perempuan' ? 'bg-pink-100 text-pink-800' : 'bg-gray-100 text-gray-800'}">
                                                ${user.gender || '-'}
                                            </span>
                                        </td>
                                        <td class="px-2 sm:px-4 py-4 text-sm text-gray-500">
                                            <div class="truncate max-w-20">${user.class || '-'}</div>
                                        </td>
                                        <td class="px-2 sm:px-4 py-4 text-sm text-gray-500">
                                            <div class="truncate max-w-28">${user.whatsapp || '-'}</div>
                                        </td>
                                        <td class="px-2 sm:px-4 py-4 text-xs font-mono text-gray-500">
                                            <button onclick="copyToken('${user.token}')" class="truncate max-w-16 sm:max-w-24 text-left hover:bg-gray-100 rounded px-1 py-1 transition-colors duration-200 cursor-pointer" title="Klik untuk copy: ${user.token}">
                                                ${user.token}
                                            </button>
                                        </td>
                                        <td class="px-2 sm:px-4 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(user.created_at).toLocaleDateString('id-ID')}</td>
                                        ${currentUser.role === 'admin' ? `
                                            <td class="px-2 sm:px-4 py-4 whitespace-nowrap text-sm font-medium">
                                                <div class="flex flex-col sm:flex-row space-y-1 sm:space-y-0 sm:space-x-2">
                                                    <button onclick="editUser('${user.__backendId}')" class="text-indigo-600 hover:text-indigo-900 text-xs">Edit</button>
                                                    <button onclick="deleteUser('${user.__backendId}')" class="text-red-600 hover:text-red-900 text-xs">Hapus</button>
                                                </div>
                                            </td>
                                        ` : ''}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    ${users.length === 0 ? '<div class="text-center py-12 text-gray-500">Belum ada data pengguna</div>' : ''}
                </div>
                
                ${currentUser.role === 'admin' ? `
                    <div id="addUserForm" class="hidden mt-6 bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Tambah Pengguna Baru</h3>
                        <form onsubmit="addUser(event)" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="userFullName" class="block text-sm font-medium text-gray-700">Nama Lengkap *</label>
                                    <input type="text" id="userFullName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="userNickname" class="block text-sm font-medium text-gray-700">Nama Panggilan</label>
                                    <input type="text" id="userNickname" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="userGender" class="block text-sm font-medium text-gray-700">Jenis Kelamin *</label>
                                    <select id="userGender" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="">Pilih Jenis Kelamin</option>
                                        <option value="Laki-laki">Laki-laki</option>
                                        <option value="Perempuan">Perempuan</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="userClass" class="block text-sm font-medium text-gray-700">Kelas</label>
                                    <input type="text" id="userClass" placeholder="Contoh: XII IPA 1" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="userWhatsApp" class="block text-sm font-medium text-gray-700">Nomor WhatsApp</label>
                                    <input type="tel" id="userWhatsApp" placeholder="Contoh: 08123456789" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 pt-4">
                                <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-medium">
                                    Simpan
                                </button>
                                <button type="button" onclick="hideAddUserForm()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 font-medium">
                                    Batal
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div id="editUserForm" class="hidden mt-6 bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Edit Pengguna</h3>
                        <form onsubmit="updateUser(event)" class="space-y-4">
                            <input type="hidden" id="editUserId">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="editUserFullName" class="block text-sm font-medium text-gray-700">Nama Lengkap *</label>
                                    <input type="text" id="editUserFullName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="editUserNickname" class="block text-sm font-medium text-gray-700">Nama Panggilan</label>
                                    <input type="text" id="editUserNickname" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div>
                                    <label for="editUserGender" class="block text-sm font-medium text-gray-700">Jenis Kelamin *</label>
                                    <select id="editUserGender" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="">Pilih Jenis Kelamin</option>
                                        <option value="Laki-laki">Laki-laki</option>
                                        <option value="Perempuan">Perempuan</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="editUserClass" class="block text-sm font-medium text-gray-700">Kelas</label>
                                    <input type="text" id="editUserClass" placeholder="Contoh: XII IPA 1" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="editUserWhatsApp" class="block text-sm font-medium text-gray-700">Nomor WhatsApp</label>
                                    <input type="tel" id="editUserWhatsApp" placeholder="Contoh: 08123456789" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 pt-4">
                                <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-medium">
                                    Update
                                </button>
                                <button type="button" onclick="hideEditUserForm()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 font-medium">
                                    Batal
                                </button>
                            </div>
                        </form>
                    </div>
                ` : ''}
            `;
        }

        function getAbsensiContent() {
            const users = allData.filter(item => item.type === 'user');
            
            return `
                <div class="mb-6 sm:mb-8">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0">
                        <h1 class="text-xl sm:text-2xl font-bold text-gray-900 responsive-text-xl">Kehadiran</h1>
                        ${currentUser.role === 'admin' || currentUser.role === 'monitor' ? `
                            <button onclick="showRekapanAbsensi()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm sm:text-base font-medium">
                                üìä Rekapan Absensi
                            </button>
                        ` : ''}
                    </div>
                </div>
                
                <!-- Form Kehadiran -->
                <div class="bg-white shadow rounded-lg p-4 sm:p-6 mb-6">
                    <h3 class="text-base sm:text-lg font-medium text-gray-900 mb-4">Form Kehadiran Hari Ini</h3>
                    <p class="text-sm text-gray-600 mb-6">Tanggal: ${new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    
                    <form onsubmit="submitAttendanceForm(event)" class="space-y-4">
                        <div class="space-y-4" id="attendanceFormList">
                            ${users.map(user => `
                                <div class="border border-gray-200 rounded-lg p-4 hover:border-indigo-300 transition-colors duration-200">
                                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-3 sm:space-y-0">
                                        <div class="flex-1">
                                            <h4 class="font-medium text-gray-900">${user.full_name || user.name}</h4>
                                            <p class="text-sm text-gray-500">${user.class || 'Tanpa Kelas'} ‚Ä¢ ${user.gender || '-'}</p>
                                        </div>
                                        <div class="flex flex-wrap gap-2">
                                            <label class="inline-flex items-center cursor-pointer">
                                                <input type="radio" name="attendance_${user.__backendId}" value="hadir" class="form-radio h-4 w-4 text-green-600 focus:ring-green-500">
                                                <span class="ml-2 text-sm font-medium text-gray-700">‚úÖ Hadir</span>
                                            </label>
                                            <label class="inline-flex items-center cursor-pointer">
                                                <input type="radio" name="attendance_${user.__backendId}" value="izin" class="form-radio h-4 w-4 text-yellow-600 focus:ring-yellow-500">
                                                <span class="ml-2 text-sm font-medium text-gray-700">üìù Izin</span>
                                            </label>
                                            <label class="inline-flex items-center cursor-pointer">
                                                <input type="radio" name="attendance_${user.__backendId}" value="sakit" class="form-radio h-4 w-4 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm font-medium text-gray-700">ü§í Sakit</span>
                                            </label>
                                            <label class="inline-flex items-center cursor-pointer">
                                                <input type="radio" name="attendance_${user.__backendId}" value="alpa" class="form-radio h-4 w-4 text-red-600 focus:ring-red-500">
                                                <span class="ml-2 text-sm font-medium text-gray-700">‚ùå Alpa</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        ${users.length === 0 ? '<div class="text-center py-8 text-gray-500">Belum ada data pengguna. Tambahkan pengguna terlebih dahulu di menu Data Nama.</div>' : `
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 pt-4">
                                <button type="submit" class="bg-green-600 text-white px-6 py-3 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 text-base font-medium">
                                    üì§ Kirim Kehadiran
                                </button>
                                <button type="button" onclick="resetAttendanceForm()" class="bg-gray-300 text-gray-700 px-6 py-3 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 text-base font-medium">
                                    üîÑ Reset
                                </button>
                            </div>
                        `}
                    </form>
                </div>
                
                <!-- Info Box -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex">
                        <svg class="h-5 w-5 text-blue-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="ml-3">
                            <p class="text-sm text-blue-700">
                                <strong>Petunjuk:</strong> Pilih status kehadiran untuk setiap peserta, kemudian klik tombol "Kirim Kehadiran" untuk menyimpan data.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function getDokumentasiContent() {
            const photos = allData.filter(item => item.type === 'media' && item.media_type === 'photo');
            const videos = allData.filter(item => item.type === 'media' && item.media_type === 'video');
            
            return `
                <div class="mb-6 sm:mb-8">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0">
                        <h1 class="text-xl sm:text-2xl font-bold text-gray-900 responsive-text-xl">Dokumentasi</h1>
                        ${currentUser.role === 'admin' || currentUser.role === 'monitor' ? `
                            <button onclick="showAddMediaForm()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm sm:text-base font-medium">
                                Upload Media
                            </button>
                        ` : ''}
                    </div>
                </div>
                
                <!-- Tabs -->
                <div class="mb-6">
                    <div class="border-b border-gray-200">
                        <nav class="-mb-px flex space-x-4 sm:space-x-8" aria-label="Tabs">
                            <button onclick="switchMediaTab('photos')" id="photosTab" class="media-tab border-b-2 border-indigo-500 text-indigo-600 whitespace-nowrap py-3 sm:py-4 px-1 text-sm sm:text-base font-medium">
                                üì∑ Foto (${photos.length})
                            </button>
                            <button onclick="switchMediaTab('videos')" id="videosTab" class="media-tab border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-3 sm:py-4 px-1 text-sm sm:text-base font-medium">
                                üé• Video (${videos.length})
                            </button>
                        </nav>
                    </div>
                </div>
                
                <!-- Photos Grid -->
                <div id="photosContent" class="media-content">
                    ${photos.length === 0 ? `
                        <div class="text-center py-12 bg-white rounded-lg shadow">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <p class="mt-4 text-gray-500">Belum ada foto yang diupload</p>
                        </div>
                    ` : `
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
                            ${photos.map(photo => `
                                <div class="bg-white rounded-lg shadow overflow-hidden hover:shadow-lg transition-shadow duration-200">
                                    <div class="aspect-w-16 aspect-h-12 bg-gray-200 flex items-center justify-center p-4">
                                        <div class="text-center">
                                            <svg class="mx-auto h-16 w-16 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                            </svg>
                                            <p class="text-xs text-gray-500">üì∑ Foto</p>
                                        </div>
                                    </div>
                                    <div class="p-4">
                                        <h3 class="font-medium text-gray-900 truncate mb-1">${photo.media_name}</h3>
                                        <p class="text-xs text-gray-500 mb-2">${new Date(photo.created_at).toLocaleDateString('id-ID')}</p>
                                        ${photo.description ? `<p class="text-sm text-gray-600 line-clamp-2 mb-3">${photo.description}</p>` : ''}
                                        ${currentUser.role === 'admin' || currentUser.role === 'monitor' ? `
                                            <div class="flex space-x-2">
                                                <button onclick="editMedia('${photo.__backendId}')" class="flex-1 text-xs bg-indigo-50 text-indigo-600 px-3 py-2 rounded hover:bg-indigo-100 font-medium">
                                                    Edit
                                                </button>
                                                <button onclick="deleteMedia('${photo.__backendId}')" class="flex-1 text-xs bg-red-50 text-red-600 px-3 py-2 rounded hover:bg-red-100 font-medium">
                                                    Hapus
                                                </button>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
                
                <!-- Videos Grid -->
                <div id="videosContent" class="media-content hidden">
                    ${videos.length === 0 ? `
                        <div class="text-center py-12 bg-white rounded-lg shadow">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                            <p class="mt-4 text-gray-500">Belum ada video yang diupload</p>
                        </div>
                    ` : `
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
                            ${videos.map(video => `
                                <div class="bg-white rounded-lg shadow overflow-hidden hover:shadow-lg transition-shadow duration-200">
                                    <div class="aspect-w-16 aspect-h-12 bg-gray-900 flex items-center justify-center p-4">
                                        <div class="text-center">
                                            <svg class="mx-auto h-16 w-16 text-gray-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            <p class="text-xs text-gray-400">üé• Video</p>
                                        </div>
                                    </div>
                                    <div class="p-4">
                                        <h3 class="font-medium text-gray-900 truncate mb-1">${video.media_name}</h3>
                                        <p class="text-xs text-gray-500 mb-2">${new Date(video.created_at).toLocaleDateString('id-ID')}</p>
                                        ${video.description ? `<p class="text-sm text-gray-600 line-clamp-2 mb-3">${video.description}</p>` : ''}
                                        ${currentUser.role === 'admin' || currentUser.role === 'monitor' ? `
                                            <div class="flex space-x-2">
                                                <button onclick="editMedia('${video.__backendId}')" class="flex-1 text-xs bg-indigo-50 text-indigo-600 px-3 py-2 rounded hover:bg-indigo-100 font-medium">
                                                    Edit
                                                </button>
                                                <button onclick="deleteMedia('${video.__backendId}')" class="flex-1 text-xs bg-red-50 text-red-600 px-3 py-2 rounded hover:bg-red-100 font-medium">
                                                    Hapus
                                                </button>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
                
                ${currentUser.role === 'admin' || currentUser.role === 'monitor' ? `
                    <!-- Add Media Form -->
                    <div id="addMediaForm" class="hidden mt-6 bg-white shadow rounded-lg p-4 sm:p-6">
                        <h3 class="text-base sm:text-lg font-medium text-gray-900 mb-4">Upload Media Baru</h3>
                        <form onsubmit="addMedia(event)" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="mediaType" class="block text-sm font-medium text-gray-700">Tipe Media *</label>
                                    <select id="mediaType" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="">Pilih Tipe</option>
                                        <option value="photo">üì∑ Foto</option>
                                        <option value="video">ÔøΩÔøΩ Video</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="mediaName" class="block text-sm font-medium text-gray-700">Nama Media *</label>
                                    <input type="text" id="mediaName" required placeholder="Contoh: Kegiatan Olahraga 2024" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="mediaDescription" class="block text-sm font-medium text-gray-700">Deskripsi</label>
                                    <textarea id="mediaDescription" rows="3" placeholder="Deskripsi singkat tentang media ini (opsional)" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                                </div>
                                <div class="md:col-span-2">
                                    <label for="mediaUploadDate" class="block text-sm font-medium text-gray-700">Tanggal Upload</label>
                                    <input type="date" id="mediaUploadDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                            <div class="bg-blue-50 border border-blue-200 rounded-md p-4">
                                <div class="flex">
                                    <svg class="h-5 w-5 text-blue-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <div class="ml-3">
                                        <p class="text-sm text-blue-700">
                                            <strong>Catatan:</strong> Sistem ini menyimpan informasi metadata media (nama, deskripsi, tanggal). File media aktual tidak disimpan dalam sistem ini.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 pt-4">
                                <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-medium">
                                    Simpan
                                </button>
                                <button type="button" onclick="hideAddMediaForm()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 font-medium">
                                    Batal
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Edit Media Form -->
                    <div id="editMediaForm" class="hidden mt-6 bg-white shadow rounded-lg p-4 sm:p-6">
                        <h3 class="text-base sm:text-lg font-medium text-gray-900 mb-4">Edit Media</h3>
                        <form onsubmit="updateMedia(event)" class="space-y-4">
                            <input type="hidden" id="editMediaId">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="editMediaType" class="block text-sm font-medium text-gray-700">Tipe Media</label>
                                    <input type="text" id="editMediaType" readonly class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-50 text-gray-500">
                                </div>
                                <div>
                                    <label for="editMediaName" class="block text-sm font-medium text-gray-700">Nama Media *</label>
                                    <input type="text" id="editMediaName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="editMediaDescription" class="block text-sm font-medium text-gray-700">Deskripsi</label>
                                    <textarea id="editMediaDescription" rows="3" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                                </div>
                                <div class="md:col-span-2">
                                    <label for="editMediaUploadDate" class="block text-sm font-medium text-gray-700">Tanggal Upload</label>
                                    <input type="date" id="editMediaUploadDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 pt-4">
                                <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-medium">
                                    Update
                                </button>
                                <button type="button" onclick="hideEditMediaForm()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 font-medium">
                                    Batal
                                </button>
                            </div>
                        </form>
                    </div>
                ` : ''}
            `;
        }

        function getDataMonitorContent() {
            const monitors = allData.filter(item => item.type === 'account' && item.role === 'monitor');
            
            return `
                <div class="mb-6 sm:mb-8">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0">
                        <h1 class="text-xl sm:text-2xl font-bold text-gray-900 responsive-text-xl">Data Monitor</h1>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                            <button onclick="showContent('data-monitor')" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 text-sm sm:text-base font-medium flex items-center justify-center">
                                <svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Refresh
                            </button>
                            <button onclick="showAddMonitorForm()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm sm:text-base font-medium">
                                Tambah Monitor
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white shadow rounded-lg overflow-hidden">
                    <div class="table-container">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Lengkap</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell">Nama Panggilan</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell">Password</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell">Tanggal Dibuat</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${monitors.map(monitor => `
                                    <tr>
                                        <td class="px-2 sm:px-4 py-4 text-sm">
                                            <div class="font-medium text-gray-900 truncate max-w-32 sm:max-w-40">${monitor.name}</div>
                                            <div class="text-xs text-gray-500 lg:hidden">${monitor.nickname || '-'}</div>
                                            <div class="text-xs text-gray-500 sm:hidden">${new Date(monitor.created_at).toLocaleDateString('id-ID')}</div>
                                        </td>
                                        <td class="px-2 sm:px-4 py-4 text-sm text-gray-500 hidden lg:table-cell">
                                            <div class="truncate max-w-24">${monitor.nickname || '-'}</div>
                                        </td>
                                        <td class="px-2 sm:px-4 py-4 text-sm text-gray-500">
                                            <div class="truncate max-w-20 sm:max-w-28">${monitor.username}</div>
                                            <div class="text-xs text-gray-400 md:hidden">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
                                        </td>
                                        <td class="px-2 sm:px-4 py-4 text-sm text-gray-500 hidden md:table-cell">
                                            <div class="font-mono truncate max-w-24">${monitor.password}</div>
                                        </td>
                                        <td class="px-2 sm:px-4 py-4 whitespace-nowrap text-sm text-gray-500 hidden sm:table-cell">${new Date(monitor.created_at).toLocaleDateString('id-ID')}</td>
                                        <td class="px-2 sm:px-4 py-4 whitespace-nowrap text-sm font-medium">
                                            <div class="flex flex-col sm:flex-row space-y-1 sm:space-y-0 sm:space-x-2">
                                                <button onclick="editMonitor('${monitor.__backendId}')" class="text-indigo-600 hover:text-indigo-900 text-xs">Edit</button>
                                                <button onclick="deleteMonitor('${monitor.__backendId}')" class="text-red-600 hover:text-red-900 text-xs">Hapus</button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    ${monitors.length === 0 ? '<div class="text-center py-12 text-gray-500">Belum ada data monitor</div>' : ''}
                </div>
                
                <div id="addMonitorForm" class="hidden mt-6 bg-white shadow rounded-lg p-4 sm:p-6">
                    <h3 class="text-base sm:text-lg font-medium text-gray-900 mb-4">Tambah Monitor Baru</h3>
                    <form onsubmit="addMonitor(event)" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="monitorName" class="block text-sm font-medium text-gray-700">Nama Lengkap Monitor *</label>
                                <input type="text" id="monitorName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="monitorNickname" class="block text-sm font-medium text-gray-700">Nama Panggilan</label>
                                <input type="text" id="monitorNickname" placeholder="Opsional - untuk tampilan dashboard" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="monitorUsername" class="block text-sm font-medium text-gray-700">Username *</label>
                                <input type="text" id="monitorUsername" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="monitorPassword" class="block text-sm font-medium text-gray-700">Password *</label>
                                <input type="text" id="monitorPassword" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 pt-4">
                            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-medium">
                                Simpan
                            </button>
                            <button type="button" onclick="hideAddMonitorForm()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 font-medium">
                                Batal
                            </button>
                        </div>
                    </form>
                </div>
                
                <div id="editMonitorForm" class="hidden mt-6 bg-white shadow rounded-lg p-4 sm:p-6">
                    <h3 class="text-base sm:text-lg font-medium text-gray-900 mb-4">Edit Monitor</h3>
                    <form onsubmit="updateMonitor(event)" class="space-y-4">
                        <input type="hidden" id="editMonitorId">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="editMonitorName" class="block text-sm font-medium text-gray-700">Nama Lengkap Monitor *</label>
                                <input type="text" id="editMonitorName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="editMonitorNickname" class="block text-sm font-medium text-gray-700">Nama Panggilan</label>
                                <input type="text" id="editMonitorNickname" placeholder="Opsional - untuk tampilan dashboard" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="editMonitorUsername" class="block text-sm font-medium text-gray-700">Username *</label>
                                <input type="text" id="editMonitorUsername" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label for="editMonitorPassword" class="block text-sm font-medium text-gray-700">Password *</label>
                                <input type="text" id="editMonitorPassword" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-md p-4">
                            <div class="flex">
                                <svg class="h-5 w-5 text-blue-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div class="ml-3">
                                    <p class="text-sm text-blue-700">
                                        <strong>Catatan:</strong> Jika monitor ini sedang login dan Anda mengubah username atau password, mereka perlu login ulang dengan kredensial baru.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 pt-4">
                            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 font-medium">
                                Update
                            </button>
                            <button type="button" onclick="hideEditMonitorForm()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500 font-medium">
                                Batal
                            </button>
                        </div>
                    </form>
                </div>
            `;
        }

        function getKehadiranContent() {
            // Find current user data
            const userData = allData.find(item => 
                item.type === 'user' && 
                item.token === currentUser.token
            );
            
            // Get user's attendance records by matching user_id
            const userAttendance = allData.filter(item => 
                item.type === 'attendance' && 
                userData && 
                item.user_id === userData.__backendId
            );
            
            // Calculate statistics
            const stats = {
                hadir: userAttendance.filter(att => att.status === 'hadir').length,
                izin: userAttendance.filter(att => att.status === 'izin').length,
                sakit: userAttendance.filter(att => att.status === 'sakit').length,
                alpa: userAttendance.filter(att => att.status === 'alpa').length,
                total: userAttendance.length
            };
            
            // Check if already recorded today
            const today = new Date().toISOString().split('T')[0];
            const todayRecord = userAttendance.find(att => att.date === today);
            
            return `
                <div class="mb-6 sm:mb-8">
                    <h1 class="text-xl sm:text-2xl font-bold text-gray-900 responsive-text-xl">Kehadiran Saya</h1>
                    <p class="mt-2 text-sm sm:text-base text-gray-600">Pantau riwayat kehadiran Anda</p>
                </div>
                
                <!-- Statistics Cards -->
                <div class="grid grid-cols-2 lg:grid-cols-5 gap-3 sm:gap-4 mb-6">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <div class="text-2xl sm:text-3xl font-bold text-gray-900">${stats.total}</div>
                        <div class="text-xs sm:text-sm text-gray-600 mt-1">üìä Total Hari</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg shadow">
                        <div class="text-2xl sm:text-3xl font-bold text-green-600">${stats.hadir}</div>
                        <div class="text-xs sm:text-sm text-green-700 mt-1">‚úÖ Hadir</div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg shadow">
                        <div class="text-2xl sm:text-3xl font-bold text-yellow-600">${stats.izin}</div>
                        <div class="text-xs sm:text-sm text-yellow-700 mt-1">ÔøΩÔøΩÔøΩÔøΩ Izin</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg shadow">
                        <div class="text-2xl sm:text-3xl font-bold text-blue-600">${stats.sakit}</div>
                        <div class="text-xs sm:text-sm text-blue-700 mt-1">ü§í Sakit</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg shadow">
                        <div class="text-2xl sm:text-3xl font-bold text-red-600">${stats.alpa}</div>
                        <div class="text-xs sm:text-sm text-red-700 mt-1">‚ùå Alpa</div>
                    </div>
                </div>
                
                <!-- Attendance Percentage -->
                ${stats.total > 0 ? `
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg shadow p-4 sm:p-6 mb-6">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <div class="mb-4 sm:mb-0">
                                <h3 class="text-base sm:text-lg font-semibold text-gray-900">Persentase Kehadiran</h3>
                                <p class="text-xs sm:text-sm text-gray-600 mt-1">Tingkat kehadiran Anda secara keseluruhan</p>
                            </div>
                            <div class="text-center">
                                <div class="text-3xl sm:text-4xl font-bold text-green-600">
                                    ${Math.round((stats.hadir / stats.total) * 100)}%
                                </div>
                                <div class="text-xs sm:text-sm text-gray-600 mt-1">
                                    ${stats.hadir} dari ${stats.total} hari
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="w-full bg-gray-200 rounded-full h-3 sm:h-4">
                                <div class="bg-gradient-to-r from-green-500 to-green-600 h-3 sm:h-4 rounded-full transition-all duration-500" style="width: ${(stats.hadir / stats.total) * 100}%"></div>
                            </div>
                        </div>
                    </div>
                ` : ''}
                
                <!-- Today's Status Card -->
                <div class="bg-white shadow rounded-lg p-4 sm:p-6 mb-6">
                    <div class="text-center">
                        ${todayRecord ? `
                            <div class="mb-6">
                                <div class="mx-auto h-20 w-20 sm:h-24 sm:w-24 ${
                                    todayRecord.status === 'hadir' ? 'bg-green-100' :
                                    todayRecord.status === 'izin' ? 'bg-yellow-100' :
                                    todayRecord.status === 'sakit' ? 'bg-blue-100' :
                                    'bg-red-100'
                                } rounded-full flex items-center justify-center mb-4">
                                    <div class="text-4xl">
                                        ${todayRecord.status === 'hadir' ? '‚úÖ' : todayRecord.status === 'izin' ? 'üìù' : todayRecord.status === 'sakit' ? 'ü§í' : '‚ùå'}
                                    </div>
                                </div>
                                <h2 class="text-lg sm:text-xl font-semibold text-gray-900">Status Kehadiran Hari Ini</h2>
                                <p class="mt-2 text-sm sm:text-base text-gray-600">Status: <span class="font-semibold ${
                                    todayRecord.status === 'hadir' ? 'text-green-600' :
                                    todayRecord.status === 'izin' ? 'text-yellow-600' :
                                    todayRecord.status === 'sakit' ? 'text-blue-600' :
                                    'text-red-600'
                                }">${todayRecord.status.charAt(0).toUpperCase() + todayRecord.status.slice(1)}</span></p>
                                <p class="text-xs sm:text-sm text-gray-500 mt-1">Dicatat oleh admin/monitor pada ${new Date(todayRecord.created_at).toLocaleTimeString('id-ID')}</p>
                            </div>
                        ` : `
                            <div class="mb-6">
                                <div class="mx-auto h-20 w-20 sm:h-24 sm:w-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                                    <svg class="h-10 w-10 sm:h-12 sm:w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                </div>
                                <h2 class="text-lg sm:text-xl font-semibold text-gray-900">Belum Ada Kehadiran Hari Ini</h2>
                                <p class="mt-2 text-sm sm:text-base text-gray-600">Kehadiran Anda akan dicatat oleh admin atau monitor</p>
                            </div>
                        `}
                        
                        <div class="mb-6">
                            <div class="text-xl sm:text-2xl font-bold text-gray-900" id="currentTime"></div>
                            <div class="text-sm sm:text-base text-gray-600" id="currentDate"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Attendance History -->
                <div class="bg-white shadow rounded-lg p-4 sm:p-6">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 space-y-2 sm:space-y-0">
                        <h3 class="text-base sm:text-lg font-medium text-gray-900">üìã Riwayat Kehadiran Lengkap</h3>
                        <span class="text-xs sm:text-sm text-gray-500">${stats.total} total catatan</span>
                    </div>
                    
                    ${stats.total === 0 ? `
                        <div class="text-center py-12">
                            <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            <p class="text-gray-500 text-sm sm:text-base">Belum ada riwayat kehadiran</p>
                            <p class="text-gray-400 text-xs sm:text-sm mt-2">Mulai catat kehadiran Anda hari ini!</p>
                        </div>
                    ` : `
                        <div class="space-y-2 sm:space-y-3 max-h-96 overflow-y-auto custom-scrollbar">
                            ${userAttendance.sort((a, b) => new Date(b.date) - new Date(a.date)).map((record, index) => `
                                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center py-3 px-3 sm:px-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200 space-y-2 sm:space-y-0">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-shrink-0 w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center text-lg sm:text-xl ${
                                            record.status === 'hadir' ? 'bg-green-100' :
                                            record.status === 'izin' ? 'bg-yellow-100' :
                                            record.status === 'sakit' ? 'bg-blue-100' :
                                            'bg-red-100'
                                        }">
                                            ${record.status === 'hadir' ? '‚úÖ' : record.status === 'izin' ? 'üìù' : record.status === 'sakit' ? 'ü§í' : '‚ùå'}
                                        </div>
                                        <div>
                                            <div class="font-medium text-gray-900 text-sm sm:text-base">
                                                ${new Date(record.date).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                                            </div>
                                            <div class="text-xs sm:text-sm text-gray-600">
                                                Dicatat: ${new Date(record.created_at).toLocaleTimeString('id-ID')}
                                                ${record.note ? ` ‚Ä¢ ${record.note}` : ''}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between sm:justify-end space-x-3">
                                        <span class="inline-flex px-2 sm:px-3 py-1 text-xs font-semibold rounded-full ${getStatusColor(record.status)}">
                                            ${record.status.charAt(0).toUpperCase() + record.status.slice(1)}
                                        </span>
                                        ${index === 0 ? '<span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full font-medium">Terbaru</span>' : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
                
                <!-- Info Box -->
                <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex">
                        <svg class="h-5 w-5 text-blue-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div class="ml-3">
                            <p class="text-xs sm:text-sm text-blue-700">
                                <strong>Catatan:</strong> Kehadiran Anda dicatat oleh admin/monitor. Anda dapat melihat riwayat lengkap kehadiran Anda di halaman ini. Jika ada kesalahan data, hubungi admin.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function getSettinganContent() {
            return `
                <div class="mb-8">
                    <h1 class="text-2xl font-bold text-gray-900">Pengaturan</h1>
                </div>
                
                <div class="bg-white shadow rounded-lg p-6">
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Informasi Akun</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Nama</label>
                                    <div class="mt-1 text-sm text-gray-900">${currentUser.name}</div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Peran</label>
                                    <div class="mt-1 text-sm text-gray-900">${currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1)}</div>
                                </div>
                                ${currentUser.username ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Username</label>
                                        <div class="mt-1 text-sm text-gray-900">${currentUser.username}</div>
                                    </div>
                                ` : ''}
                                ${currentUser.token ? `
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Token</label>
                                        <div class="mt-1 text-sm text-gray-900 font-mono">${currentUser.token}</div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        ${currentUser.role !== 'user' ? `
                            <div>
                                <h3 class="text-lg font-medium text-gray-900 mb-4">Ubah Password</h3>
                                <form onsubmit="changePassword(event)" class="space-y-4 max-w-md">
                                    <div>
                                        <label for="currentPassword" class="block text-sm font-medium text-gray-700">Password Saat Ini</label>
                                        <input type="password" id="currentPassword" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label for="newPassword" class="block text-sm font-medium text-gray-700">Password Baru</label>
                                        <input type="password" id="newPassword" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label for="confirmPassword" class="block text-sm font-medium text-gray-700">Konfirmasi Password Baru</label>
                                        <input type="password" id="confirmPassword" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        Ubah Password
                                    </button>
                                </form>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }



        function getStatusColor(status) {
            switch(status) {
                case 'hadir': return 'bg-green-100 text-green-800';
                case 'izin': return 'bg-yellow-100 text-yellow-800';
                case 'sakit': return 'bg-blue-100 text-blue-800';
                case 'alpa': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Action functions
        function generateToken() {
            return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        function copyToken(token) {
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(token).then(() => {
                    showSuccess('Token berhasil dicopy ke clipboard!');
                }).catch(() => {
                    fallbackCopyToken(token);
                });
            } else {
                fallbackCopyToken(token);
            }
        }

        function fallbackCopyToken(token) {
            // Fallback method for older browsers or non-secure contexts
            const textArea = document.createElement('textarea');
            textArea.value = token;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showSuccess('Token berhasil dicopy ke clipboard!');
            } catch (err) {
                showError('Gagal copy token. Silakan copy manual.');
            } finally {
                document.body.removeChild(textArea);
            }
        }

        async function addUser(event) {
            event.preventDefault();
            
            if (currentRecordCount >= 999) {
                showError("Batas maksimum 999 data telah tercapai. Hapus beberapa data terlebih dahulu.");
                return;
            }
            
            const fullName = document.getElementById('userFullName').value;
            const nickname = document.getElementById('userNickname').value;
            const gender = document.getElementById('userGender').value;
            const userClass = document.getElementById('userClass').value;
            const whatsapp = document.getElementById('userWhatsApp').value;
            const token = generateToken();
            
            const result = await window.dataSdk.create({
                id: `user_${Date.now()}`,
                type: 'user',
                name: fullName, // Keep for backward compatibility
                full_name: fullName,
                nickname: nickname,
                gender: gender,
                class: userClass,
                whatsapp: whatsapp,
                token: token,
                created_at: new Date().toISOString()
            });
            
            if (result.isOk) {
                showSuccess('Pengguna berhasil ditambahkan');
                hideAddUserForm();
                // Clear form
                document.getElementById('userFullName').value = '';
                document.getElementById('userNickname').value = '';
                document.getElementById('userGender').value = '';
                document.getElementById('userClass').value = '';
                document.getElementById('userWhatsApp').value = '';
            } else {
                showError('Gagal menambahkan pengguna');
            }
        }

        async function deleteUser(backendId) {
            const user = allData.find(item => item.__backendId === backendId);
            if (user) {
                const result = await window.dataSdk.delete(user);
                if (result.isOk) {
                    showSuccess('Pengguna berhasil dihapus');
                } else {
                    showError('Gagal menghapus pengguna');
                }
            }
        }

        async function addMonitor(event) {
            event.preventDefault();
            
            if (currentRecordCount >= 999) {
                showError("Batas maksimum 999 data telah tercapai. Hapus beberapa data terlebih dahulu.");
                return;
            }
            
            const name = document.getElementById('monitorName').value;
            const nickname = document.getElementById('monitorNickname').value;
            const username = document.getElementById('monitorUsername').value;
            const password = document.getElementById('monitorPassword').value;
            
            const result = await window.dataSdk.create({
                id: `monitor_${Date.now()}`,
                type: 'account',
                name: name,
                nickname: nickname || '',
                username: username,
                password: password,
                role: 'monitor',
                created_at: new Date().toISOString()
            });
            
            if (result.isOk) {
                showSuccess('Monitor berhasil ditambahkan');
                hideAddMonitorForm();
                document.getElementById('monitorName').value = '';
                document.getElementById('monitorNickname').value = '';
                document.getElementById('monitorUsername').value = '';
                document.getElementById('monitorPassword').value = '';
            } else {
                showError('Gagal menambahkan monitor');
            }
        }

        async function deleteMonitor(backendId) {
            const monitor = allData.find(item => item.__backendId === backendId);
            if (monitor) {
                const result = await window.dataSdk.delete(monitor);
                if (result.isOk) {
                    showSuccess('Monitor berhasil dihapus');
                } else {
                    showError('Gagal menghapus monitor');
                }
            }
        }



        async function changePassword(event) {
            event.preventDefault();
            
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword !== confirmPassword) {
                showError('Konfirmasi password tidak cocok');
                return;
            }
            
            // Find current user account
            const account = allData.find(item => 
                item.type === 'account' && 
                item.username === currentUser.username && 
                item.password === currentPassword
            );
            
            if (!account) {
                showError('Password saat ini salah');
                return;
            }
            
            const updatedAccount = { ...account, password: newPassword };
            const result = await window.dataSdk.update(updatedAccount);
            
            if (result.isOk) {
                showSuccess('Password berhasil diubah');
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
            } else {
                showError('Gagal mengubah password');
            }
        }

        async function editUser(backendId) {
            const user = allData.find(item => item.__backendId === backendId);
            if (user) {
                document.getElementById('editUserId').value = backendId;
                document.getElementById('editUserFullName').value = user.full_name || user.name || '';
                document.getElementById('editUserNickname').value = user.nickname || '';
                document.getElementById('editUserGender').value = user.gender || '';
                document.getElementById('editUserClass').value = user.class || '';
                document.getElementById('editUserWhatsApp').value = user.whatsapp || '';
                
                hideAddUserForm();
                document.getElementById('editUserForm').classList.remove('hidden');
            }
        }

        async function updateUser(event) {
            event.preventDefault();
            
            const backendId = document.getElementById('editUserId').value;
            const user = allData.find(item => item.__backendId === backendId);
            
            if (!user) {
                showError('Pengguna tidak ditemukan');
                return;
            }
            
            const fullName = document.getElementById('editUserFullName').value;
            const nickname = document.getElementById('editUserNickname').value;
            const gender = document.getElementById('editUserGender').value;
            const userClass = document.getElementById('editUserClass').value;
            const whatsapp = document.getElementById('editUserWhatsApp').value;
            
            const updatedUser = {
                ...user,
                name: fullName, // Keep for backward compatibility
                full_name: fullName,
                nickname: nickname,
                gender: gender,
                class: userClass,
                whatsapp: whatsapp
            };
            
            const result = await window.dataSdk.update(updatedUser);
            
            if (result.isOk) {
                showSuccess('Data pengguna berhasil diperbarui');
                hideEditUserForm();
            } else {
                showError('Gagal memperbarui data pengguna');
            }
        }

        function showAddUserForm() {
            hideEditUserForm();
            document.getElementById('addUserForm').classList.remove('hidden');
        }

        function hideAddUserForm() {
            document.getElementById('addUserForm').classList.add('hidden');
        }

        function hideEditUserForm() {
            document.getElementById('editUserForm').classList.add('hidden');
        }

        function showAddMonitorForm() {
            hideEditMonitorForm();
            document.getElementById('addMonitorForm').classList.remove('hidden');
        }

        function hideAddMonitorForm() {
            document.getElementById('addMonitorForm').classList.add('hidden');
        }

        function hideEditMonitorForm() {
            document.getElementById('editMonitorForm').classList.add('hidden');
        }

        async function editMonitor(backendId) {
            const monitor = allData.find(item => item.__backendId === backendId);
            if (monitor) {
                document.getElementById('editMonitorId').value = backendId;
                document.getElementById('editMonitorName').value = monitor.name;
                document.getElementById('editMonitorNickname').value = monitor.nickname || '';
                document.getElementById('editMonitorUsername').value = monitor.username;
                document.getElementById('editMonitorPassword').value = monitor.password;
                
                hideAddMonitorForm();
                document.getElementById('editMonitorForm').classList.remove('hidden');
            }
        }

        async function updateMonitor(event) {
            event.preventDefault();
            
            const backendId = document.getElementById('editMonitorId').value;
            const monitor = allData.find(item => item.__backendId === backendId);
            
            if (!monitor) {
                showError('Monitor tidak ditemukan');
                return;
            }
            
            const name = document.getElementById('editMonitorName').value;
            const nickname = document.getElementById('editMonitorNickname').value;
            const username = document.getElementById('editMonitorUsername').value;
            const password = document.getElementById('editMonitorPassword').value;
            
            const updatedMonitor = {
                ...monitor,
                name: name,
                nickname: nickname || '',
                username: username,
                password: password
            };
            
            const result = await window.dataSdk.update(updatedMonitor);
            
            if (result.isOk) {
                showSuccess('Data monitor berhasil diperbarui');
                hideEditMonitorForm();
                
                // If current user is the monitor being edited and credentials changed, logout
                if (currentUser && currentUser.username === monitor.username && 
                    (username !== monitor.username || password !== monitor.password)) {
                    setTimeout(() => {
                        showError('Kredensial Anda telah diubah. Silakan login kembali.');
                        setTimeout(() => {
                            document.getElementById('logoutBtn').click();
                        }, 2000);
                    }, 1000);
                }
            } else {
                showError('Gagal memperbarui data monitor');
            }
        }

        // Attendance form functions
        async function submitAttendanceForm(event) {
            event.preventDefault();
            
            const users = allData.filter(item => item.type === 'user');
            const today = new Date().toISOString().split('T')[0];
            const attendance = allData.filter(item => item.type === 'attendance');
            
            // Check if attendance for today already exists
            const todayAttendance = attendance.filter(att => att.date === today);
            if (todayAttendance.length > 0) {
                showError('Kehadiran untuk hari ini sudah diisi. Tidak dapat mengisi ulang.');
                return;
            }
            
            let successCount = 0;
            let errorCount = 0;
            
            for (const user of users) {
                const selectedStatus = document.querySelector(`input[name="attendance_${user.__backendId}"]:checked`);
                
                if (selectedStatus) {
                    if (currentRecordCount + successCount >= 999) {
                        showError("Batas maksimum 999 data telah tercapai.");
                        break;
                    }
                    
                    const result = await window.dataSdk.create({
                        id: `attendance_${Date.now()}_${user.__backendId}`,
                        type: 'attendance',
                        user_id: user.__backendId,
                        user_name: user.full_name || user.name,
                        user_gender: user.gender || '',
                        user_class: user.class || '',
                        date: today,
                        status: selectedStatus.value,
                        note: '',
                        created_at: new Date().toISOString()
                    });
                    
                    if (result.isOk) {
                        successCount++;
                    } else {
                        errorCount++;
                    }
                }
            }
            
            if (successCount > 0) {
                showSuccess(`Kehadiran berhasil disimpan untuk ${successCount} peserta`);
                resetAttendanceForm();
            }
            
            if (errorCount > 0) {
                showError(`Gagal menyimpan ${errorCount} data kehadiran`);
            }
            
            if (successCount === 0 && errorCount === 0) {
                showError('Pilih minimal satu status kehadiran');
            }
        }

        function resetAttendanceForm() {
            const users = allData.filter(item => item.type === 'user');
            users.forEach(user => {
                const radios = document.querySelectorAll(`input[name="attendance_${user.__backendId}"]`);
                radios.forEach(radio => radio.checked = false);
            });
        }

        function showRekapanAbsensi() {
            const attendance = allData.filter(item => item.type === 'attendance');
            const users = allData.filter(item => item.type === 'user');
            
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="mb-6 sm:mb-8">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0">
                        <h1 class="text-xl sm:text-2xl font-bold text-gray-900 responsive-text-xl">ÔøΩÔøΩ Rekapan Absensi</h1>
                        <button onclick="showContent('absensi')" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 text-sm sm:text-base font-medium">
                            ÔøΩÔøΩÔøΩ Kembali ke Form Kehadiran
                        </button>
                    </div>
                </div>
                
                <div class="bg-white shadow rounded-lg overflow-hidden">
                    <div class="table-container">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Lengkap</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell">Gender</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell">Kelas</th>
                                    <th class="px-2 sm:px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">‚úÖ Hadir</th>
                                    <th class="px-2 sm:px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">üìù Izin</th>
                                    <th class="px-2 sm:px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">ü§í Sakit</th>
                                    <th class="px-2 sm:px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">‚ùå Alpa</th>
                                    <th class="px-2 sm:px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${users.map(user => {
                                    const userAttendance = attendance.filter(att => att.user_id === user.__backendId);
                                    const stats = {
                                        hadir: userAttendance.filter(att => att.status === 'hadir').length,
                                        izin: userAttendance.filter(att => att.status === 'izin').length,
                                        sakit: userAttendance.filter(att => att.status === 'sakit').length,
                                        alpa: userAttendance.filter(att => att.status === 'alpa').length
                                    };
                                    
                                    return `
                                        <tr>
                                            <td class="px-2 sm:px-4 py-4 text-sm">
                                                <div class="font-medium text-gray-900 truncate max-w-32 sm:max-w-40">${user.full_name || user.name || '-'}</div>
                                                <div class="text-xs text-gray-500 md:hidden">${user.gender || '-'}</div>
                                                <div class="text-xs text-gray-500 lg:hidden">${user.class || '-'}</div>
                                            </td>
                                            <td class="px-2 sm:px-4 py-4 text-sm text-gray-500 hidden md:table-cell">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${user.gender === 'Laki-laki' ? 'bg-blue-100 text-blue-800' : user.gender === 'Perempuan' ? 'bg-pink-100 text-pink-800' : 'bg-gray-100 text-gray-800'}">
                                                    ${user.gender || '-'}
                                                </span>
                                            </td>
                                            <td class="px-2 sm:px-4 py-4 text-sm text-gray-500 hidden lg:table-cell">
                                                <div class="truncate max-w-20">${user.class || '-'}</div>
                                            </td>
                                            <td class="px-2 sm:px-4 py-4 text-center">
                                                <span class="inline-flex items-center justify-center w-8 h-8 text-sm font-semibold rounded-full bg-green-100 text-green-800">
                                                    ${stats.hadir}
                                                </span>
                                            </td>
                                            <td class="px-2 sm:px-4 py-4 text-center">
                                                <span class="inline-flex items-center justify-center w-8 h-8 text-sm font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                                    ${stats.izin}
                                                </span>
                                            </td>
                                            <td class="px-2 sm:px-4 py-4 text-center">
                                                <span class="inline-flex items-center justify-center w-8 h-8 text-sm font-semibold rounded-full bg-blue-100 text-blue-800">
                                                    ${stats.sakit}
                                                </span>
                                            </td>
                                            <td class="px-2 sm:px-4 py-4 text-center">
                                                <span class="inline-flex items-center justify-center w-8 h-8 text-sm font-semibold rounded-full bg-red-100 text-red-800">
                                                    ${stats.alpa}
                                                </span>
                                            </td>
                                            <td class="px-2 sm:px-4 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="viewUserAttendanceDetail('${user.__backendId}')" class="text-indigo-600 hover:text-indigo-900 text-xs">
                                                    Detail
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                    ${users.length === 0 ? '<div class="text-center py-12 text-gray-500">Belum ada data pengguna</div>' : ''}
                </div>
            `;
        }

        function viewUserAttendanceDetail(userId) {
            const user = allData.find(item => item.__backendId === userId);
            const userAttendance = allData.filter(item => item.type === 'attendance' && item.user_id === userId);
            
            if (!user) {
                showError('Pengguna tidak ditemukan');
                return;
            }
            
            const detailContent = `
                <div class="mb-6">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center space-y-3 sm:space-y-0">
                        <div>
                            <h1 class="text-xl sm:text-2xl font-bold text-gray-900">Detail Kehadiran - ${user.full_name || user.name}</h1>
                            <p class="text-gray-600 mt-2">${user.gender || '-'} ‚Ä¢ ${user.class || 'Tanpa Kelas'}</p>
                        </div>
                        <button onclick="showRekapanAbsensi()" class="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 text-sm sm:text-base font-medium">
                            ‚Üê Kembali ke Rekapan
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="text-2xl font-bold text-green-600">${userAttendance.filter(att => att.status === 'hadir').length}</div>
                        <div class="text-sm text-green-700">‚úÖ Hadir</div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <div class="text-2xl font-bold text-yellow-600">${userAttendance.filter(att => att.status === 'izin').length}</div>
                        <div class="text-sm text-yellow-700">üìù Izin</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-2xl font-bold text-blue-600">${userAttendance.filter(att => att.status === 'sakit').length}</div>
                        <div class="text-sm text-blue-700">ü§í Sakit</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg">
                        <div class="text-2xl font-bold text-red-600">${userAttendance.filter(att => att.status === 'alpa').length}</div>
                        <div class="text-sm text-red-700">‚ùå Alpa</div>
                    </div>
                </div>
                
                <div class="bg-white shadow rounded-lg overflow-hidden">
                    <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">Riwayat Kehadiran</h3>
                    </div>
                    <div class="table-container">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keterangan</th>
                                    ${currentUser.role === 'admin' ? '<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>' : ''}
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${userAttendance.sort((a, b) => new Date(b.date) - new Date(a.date)).map(att => `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${new Date(att.date).toLocaleDateString('id-ID')}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getStatusColor(att.status)}">
                                                ${att.status === 'hadir' ? '‚úÖ' : att.status === 'izin' ? 'üìù' : att.status === 'sakit' ? 'ü§í' : '‚ùå'} ${att.status.charAt(0).toUpperCase() + att.status.slice(1)}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 text-sm text-gray-500">${att.note || '-'}</td>
                                        ${currentUser.role === 'admin' ? `
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="deleteAttendanceRecord('${att.__backendId}')" class="text-red-600 hover:text-red-900">Hapus</button>
                                            </td>
                                        ` : ''}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    ${userAttendance.length === 0 ? '<div class="text-center py-12 text-gray-500">Belum ada data kehadiran</div>' : ''}
                </div>
            `;
            
            document.getElementById('mainContent').innerHTML = detailContent;
        }

        async function deleteAttendanceRecord(backendId) {
            const attendance = allData.find(item => item.__backendId === backendId);
            if (attendance) {
                const result = await window.dataSdk.delete(attendance);
                if (result.isOk) {
                    showSuccess('Data kehadiran berhasil dihapus');
                    // Refresh the detail view
                    setTimeout(() => {
                        viewUserAttendanceDetail(attendance.user_id);
                    }, 500);
                } else {
                    showError('Gagal menghapus data kehadiran');
                }
            }
        }

        // Media management functions
        function switchMediaTab(tab) {
            // Update tab styles
            document.querySelectorAll('.media-tab').forEach(tabBtn => {
                tabBtn.classList.remove('border-indigo-500', 'text-indigo-600');
                tabBtn.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Hide all content
            document.querySelectorAll('.media-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected tab and content
            if (tab === 'photos') {
                document.getElementById('photosTab').classList.remove('border-transparent', 'text-gray-500');
                document.getElementById('photosTab').classList.add('border-indigo-500', 'text-indigo-600');
                document.getElementById('photosContent').classList.remove('hidden');
            } else if (tab === 'videos') {
                document.getElementById('videosTab').classList.remove('border-transparent', 'text-gray-500');
                document.getElementById('videosTab').classList.add('border-indigo-500', 'text-indigo-600');
                document.getElementById('videosContent').classList.remove('hidden');
            }
        }

        function showAddMediaForm() {
            hideEditMediaForm();
            document.getElementById('addMediaForm').classList.remove('hidden');
            // Set today's date as default
            document.getElementById('mediaUploadDate').value = new Date().toISOString().split('T')[0];
        }

        function hideAddMediaForm() {
            document.getElementById('addMediaForm').classList.add('hidden');
        }

        function hideEditMediaForm() {
            document.getElementById('editMediaForm').classList.add('hidden');
        }

        async function addMedia(event) {
            event.preventDefault();
            
            if (currentRecordCount >= 999) {
                showError("Batas maksimum 999 data telah tercapai. Hapus beberapa data terlebih dahulu.");
                return;
            }
            
            const mediaType = document.getElementById('mediaType').value;
            const mediaName = document.getElementById('mediaName').value;
            const description = document.getElementById('mediaDescription').value;
            const uploadDate = document.getElementById('mediaUploadDate').value || new Date().toISOString().split('T')[0];
            
            const result = await window.dataSdk.create({
                id: `media_${Date.now()}`,
                type: 'media',
                media_type: mediaType,
                media_name: mediaName,
                description: description || '',
                upload_date: uploadDate,
                created_at: new Date().toISOString()
            });
            
            if (result.isOk) {
                showSuccess(`${mediaType === 'photo' ? 'Foto' : 'Video'} berhasil ditambahkan`);
                hideAddMediaForm();
                // Clear form
                document.getElementById('mediaType').value = '';
                document.getElementById('mediaName').value = '';
                document.getElementById('mediaDescription').value = '';
                document.getElementById('mediaUploadDate').value = '';
            } else {
                showError('Gagal menambahkan media');
            }
        }

        async function editMedia(backendId) {
            const media = allData.find(item => item.__backendId === backendId);
            if (media) {
                document.getElementById('editMediaId').value = backendId;
                document.getElementById('editMediaType').value = media.media_type === 'photo' ? 'ÔøΩÔøΩ Foto' : 'üé• Video';
                document.getElementById('editMediaName').value = media.media_name;
                document.getElementById('editMediaDescription').value = media.description || '';
                document.getElementById('editMediaUploadDate').value = media.upload_date || '';
                
                hideAddMediaForm();
                document.getElementById('editMediaForm').classList.remove('hidden');
            }
        }

        async function updateMedia(event) {
            event.preventDefault();
            
            const backendId = document.getElementById('editMediaId').value;
            const media = allData.find(item => item.__backendId === backendId);
            
            if (!media) {
                showError('Media tidak ditemukan');
                return;
            }
            
            const mediaName = document.getElementById('editMediaName').value;
            const description = document.getElementById('editMediaDescription').value;
            const uploadDate = document.getElementById('editMediaUploadDate').value;
            
            const updatedMedia = {
                ...media,
                media_name: mediaName,
                description: description || '',
                upload_date: uploadDate || media.upload_date
            };
            
            const result = await window.dataSdk.update(updatedMedia);
            
            if (result.isOk) {
                showSuccess('Media berhasil diperbarui');
                hideEditMediaForm();
            } else {
                showError('Gagal memperbarui media');
            }
        }

        async function deleteMedia(backendId) {
            const media = allData.find(item => item.__backendId === backendId);
            if (media) {
                const result = await window.dataSdk.delete(media);
                if (result.isOk) {
                    showSuccess('Media berhasil dihapus');
                } else {
                    showError('Gagal menghapus media');
                }
            }
        }

        function updateTime() {
            const now = new Date();
            const timeElement = document.getElementById('currentTime');
            const dateElement = document.getElementById('currentDate');
            
            if (timeElement) {
                timeElement.textContent = now.toLocaleTimeString('id-ID');
            }
            if (dateElement) {
                dateElement.textContent = now.toLocaleDateString('id-ID', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            }
        }

        // Password visibility toggle
        function togglePasswordVisibility(inputId, iconId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(iconId);
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>';
            } else {
                input.type = 'password';
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>';
            }
        }

        // Mobile menu functions
        function openMobileMenu() {
            document.getElementById('sidebar').classList.add('open');
            document.getElementById('mobileMenuOverlay').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileMenu() {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('mobileMenuOverlay').classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Event listeners
        document.getElementById('tokenLoginBtn').addEventListener('click', () => {
            document.getElementById('tokenModal').classList.remove('hidden');
        });

        document.getElementById('credentialLoginBtn').addEventListener('click', () => {
            document.getElementById('credentialModal').classList.remove('hidden');
        });

        document.getElementById('closeTokenModal').addEventListener('click', () => {
            document.getElementById('tokenModal').classList.add('hidden');
        });

        document.getElementById('closeCredentialModal').addEventListener('click', () => {
            document.getElementById('credentialModal').classList.add('hidden');
        });

        // Mobile menu event listeners
        document.getElementById('mobileMenuBtn').addEventListener('click', openMobileMenu);
        document.getElementById('closeMobileMenu').addEventListener('click', closeMobileMenu);
        document.getElementById('mobileMenuOverlay').addEventListener('click', closeMobileMenu);

        document.getElementById('tokenForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = document.getElementById('tokenInput').value;
            
            if (!token) {
                showError('Token tidak boleh kosong');
                return;
            }
            
            const auth = await authenticateToken(token);
            if (auth.success) {
                document.getElementById('tokenModal').classList.add('hidden');
                showDashboard(auth.user);
                showSuccess('Login berhasil');
            } else {
                showError(auth.message);
            }
        });

        document.getElementById('credentialForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('usernameInput').value;
            const password = document.getElementById('passwordInput').value;
            
            if (!username || !password) {
                showError('Username dan password tidak boleh kosong');
                return;
            }
            
            const auth = await authenticateCredentials(username, password);
            if (auth.success) {
                document.getElementById('credentialModal').classList.add('hidden');
                showDashboard(auth.user);
                showSuccess('Login berhasil');
            } else {
                showError(auth.message);
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            currentUser = null;
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginPage').style.display = 'flex';
            
            // Clear forms
            document.getElementById('tokenInput').value = '';
            document.getElementById('usernameInput').value = '';
            document.getElementById('passwordInput').value = '';
            
            showSuccess('Logout berhasil');
        });

        // Add scroll detection for table containers on mobile
        function setupTableScrollDetection() {
            const tableContainers = document.querySelectorAll('.table-container');
            tableContainers.forEach(container => {
                container.addEventListener('scroll', function() {
                    if (this.scrollLeft > 10) {
                        this.classList.add('scrolled');
                    } else {
                        this.classList.remove('scrolled');
                    }
                });
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeSDKs();
            
            // Create default admin account if no accounts exist
            setTimeout(async () => {
                const accounts = allData.filter(item => item.type === 'account');
                if (accounts.length === 0 && currentRecordCount < 999) {
                    await window.dataSdk.create({
                        id: 'admin_default',
                        type: 'account',
                        name: 'Administrator',
                        username: 'admin',
                        password: 'admin123',
                        role: 'admin',
                        created_at: new Date().toISOString()
                    });
                }
            }, 1000);
            
            // Update time every second
            setInterval(updateTime, 1000);
            updateTime();
            
            // Setup table scroll detection
            setupTableScrollDetection();
            
            // Re-setup scroll detection when content changes
            const observer = new MutationObserver(() => {
                setupTableScrollDetection();
            });
            observer.observe(document.getElementById('mainContent'), {
                childList: true,
                subtree: true
            });
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a3630abc3b6f8e2',t:'MTc2Mzk1ODgyNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
